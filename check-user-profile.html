<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check User Profile</title>
</head>
<body>
    <h1>Check User Profile</h1>
    <div id="output"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';        // ⚠️ SECURITY WARNING: Replace these values with your actual Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_FIREBASE_API_KEY", // Replace with actual API key
            authDomain: "sermon-notes-assistant.firebaseapp.com",
            projectId: "sermon-notes-assistant",
            storageBucket: "sermon-notes-assistant.firebasestorage.app",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID", // Replace with actual sender ID
            appId: "YOUR_APP_ID", // Replace with actual app ID
            measurementId: "YOUR_MEASUREMENT_ID" // Replace with actual measurement ID
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const output = document.getElementById('output');

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                output.innerHTML = `<p>Logged in as: ${user.email}</p><p>User ID: ${user.uid}</p>`;
                
                try {
                    const userDoc = await getDoc(doc(db, "userProfiles", user.uid));
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        output.innerHTML += `<h2>User Profile Data:</h2><pre>${JSON.stringify(userData, null, 2)}</pre>`;
                        
                        // Check specific fields
                        output.innerHTML += `<h2>Key Fields:</h2>`;
                        output.innerHTML += `<p><strong>exbAuthorized:</strong> ${userData.exbAuthorized}</p>`;
                        output.innerHTML += `<p><strong>defaultBibleVersion:</strong> ${userData.defaultBibleVersion}</p>`;
                        
                        if (!userData.hasOwnProperty('defaultBibleVersion')) {
                            output.innerHTML += `<p style="color: red;">❌ defaultBibleVersion field is missing!</p>`;
                            output.innerHTML += `<p><strong>Available fields:</strong> ${Object.keys(userData).join(', ')}</p>`;
                        } else if (userData.defaultBibleVersion === null) {
                            output.innerHTML += `<p style="color: orange;">⚠️ defaultBibleVersion field is null</p>`;
                        } else if (userData.defaultBibleVersion === undefined) {
                            output.innerHTML += `<p style="color: orange;">⚠️ defaultBibleVersion field is undefined</p>`;
                        } else {
                            output.innerHTML += `<p style="color: green;">✅ defaultBibleVersion field exists with value: ${userData.defaultBibleVersion}</p>`;
                        }
                    } else {
                        output.innerHTML += `<p style="color: red;">❌ User profile not found in userProfiles collection</p>`;
                    }
                } catch (error) {
                    output.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
                }
            } else {
                output.innerHTML = `<p style="color: red;">Not logged in. Please log in to your Sermon Notes Assistant app first, then refresh this page.</p>`;
            }
        });
    </script>
</body>
</html>
